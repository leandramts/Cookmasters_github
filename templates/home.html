{% extends 'base.html' %}
{% block content %}

<div class="home-bg">

    <div class="boas-vindas">

        {% if user.is_authenticated %}

            <h2>Olá, {{ user.nome }}!</h2>

            <div class="btn-welcome-container">

                {# BOTÃO DO CONSUMIDOR — Minhas Receitas #}
                {% if user.e_consumidor %}
                    <a href="{% url 'minhas_receitas' %}" class="btn-welcome">
                        Minhas Receitas
                    </a>
                {% endif %}

                {# BOTÃO DO CHEFE — Relatório de vendas #}
                {% if user.e_chefe %}
                    <a href="{% url 'relatorio_vendas_chefe' %}" class="btn-welcome">
                        Relatório de Vendas
                    </a>
                {% endif %}

                {# BOTÕES DO ADMIN — Usuários / Receitas / Comentários #}
                {% if user.is_superuser %}
                    <a href="{% url 'listar_usuarios' %}" class="btn-welcome">
                        Gerenciar Usuários
                    </a>

                    <a href="{% url 'listar_receitas' %}" class="btn-welcome">
                        Gerenciar Receitas
                    </a>

                    <a href="{% url 'listar_comentarios' %}" class="btn-welcome">
                        Gerenciar Comentários
                    </a>
                {% endif %}

            </div>

        {% else %}

            <h1>Bem-vindo ao Cookmasters!</h1>
            <p>Sua plataforma para descobrir e partilhar receitas. Faça login ou cadastre-se!</p>

        {% endif %}

    </div>  {# Fim boas-vindas #}

    <hr>

    <div class="filtro-box">

        <form method="GET" action="{% url 'filtro' %}">
            
            <!-- DIFICULDADE -->
            <label><strong>Dificuldade:</strong></label>
            <select name="dificuldade">
                <option value="" {% if selecionada_dificuldade == "" %}selected{% endif %}>Todas</option>
                <option value="facil" {% if selecionada_dificuldade == "facil" %}selected{% endif %}>Fácil</option>
                <option value="medio" {% if selecionada_dificuldade == "medio" %}selected{% endif %}>Médio</option>
                <option value="dificil" {% if selecionada_dificuldade == "dificil" %}selected{% endif %}>Difícil</option>
            </select>

            <!-- TEMPO -->
            <label><strong>Tempo de Preparo:</strong></label>
            <select name="tempo">
                <option value="" {% if selecionado_tempo == "" %}selected{% endif %}>Qualquer tempo</option>
                <option value="1" {% if selecionado_tempo == "1" %}selected{% endif %}>Até 15 min</option>
                <option value="2" {% if selecionado_tempo == "2" %}selected{% endif %}>15 a 30 min</option>
                <option value="3" {% if selecionado_tempo == "3" %}selected{% endif %}>30 a 60 min</option>
                <option value="4" {% if selecionado_tempo == "4" %}selected{% endif %}>Mais de 60 min</option>
            </select>

            <!-- TAGS -->
            <label><strong>Tags:</strong></label>
            <div class="tag-box">
                {% for tag in todas_tags %}
                    <label>
                        <input type="checkbox"
                               name="tags"
                               value="{{ tag.id }}"
                               {% if tag.id|stringformat:"s" in selecionadas_tags %}checked{% endif %}>
                        {{ tag.nome }}
                    </label>
                {% endfor %}
            </div>

            <button type="submit" class="btn-filtrar">Filtrar</button>

        </form>
    </div>

    <hr>

    <h2>Receitas em Destaque</h2>

    <div class="recipe-grid">
        {% for receita in receitas %}
            <div class="recipe-card">
                <h3>
                    <a href="{% url 'visualizar_receita' receita.id %}" style="color:#088341; text-decoration:none;">
                        {{ receita.nome }}
                    </a>
                </h3>

                <p>Por: 
                    <a href="{% url 'visualizar_chefe' receita.autor.id %}">
                        {{ receita.autor.usuario.nome }}
                    </a>
                </p>
                
                <p>Nota: {{ receita.nota }} ★</p>
                <p>Preço: R$ {{ receita.preco }}</p>
                
                <p><strong>Tempo de Preparo:</strong> {{ receita.tempo_preparo }} minutos</p>
                <p><strong>Dificuldade:</strong> {{ receita.dificuldade|capfirst }}</p> 

                <p><strong>Tags:</strong>
                    {% if receita.tags.all %}
                        {% for tag in receita.tags.all %}
                            <span class="tag">{{ tag.nome }}</span>
                        {% endfor %}
                    {% else %}
                        <span class="no-tag">Sem tags</span>
                    {% endif %}
                </p>
            </div>
        {% empty %}
            <p>Ainda não há receitas cadastradas no site.</p>
        {% endfor %}
    </div>

</div>

{% endblock %}
