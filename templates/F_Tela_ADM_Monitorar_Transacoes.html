{% extends "base.html" %}

{% block content %}
<div class="container">
    <h2>Monitoramento de Transações Financeiras </h2>
    <hr>

    {% if totais.total_bruto_geral %}
        <div class="summary-cards">
            <h3>Resumo Financeiro Geral</h3>
            <p>Valor Bruto Total Transacionado: R$ <strong>{{ totais.total_bruto_geral|floatformat:2 }}</strong></p>
            <p>Total Arrecadado (Taxa Adm): R$ <strong>{{ totais.total_taxa_adm_geral|floatformat:2 }}</strong></p>
            <p>Total Repassado aos Chefes: R$ <strong>{{ totais.total_repasse_chefe_geral|floatformat:2 }}</strong></p>
        </div>
    {% endif %}

    <h3>Detalhes de Todas as Compras</h3>
    
    {% if transacoes %}
        <table>
            <thead>
                <tr>
                    <th>Data</th>
                    <th>Receita</th>
                    <th>Consumidor</th>
                    <th>Chefe (Autor)</th>
                    <th>Valor Bruto (R$)</th>
                    <th>Taxa Adm (R$)</th>
                    <th>Repasse Chefe (R$)</th>
                </tr>
            </thead>
            <tbody>
                {% for transacao in transacoes %}
                    <tr>
                        <td>{{ transacao.data_compra|date:"d/m/Y H:i" }}</td>
                        <td>{{ transacao.receita.nome }}</td>
                        <td>{{ transacao.consumidor.usuario.nome }}</td>
                        <td>{{ transacao.receita.autor.usuario.nome }}</td>
                        
                        
                        <td>{{ transacao.preco_receita|floatformat:2 }}</td>
                        <td>{{ transacao.valor_taxa_adm|floatformat:2 }}</td>
                        <td>{{ transacao.repasse_chefe|floatformat:2 }}</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p>Nenhuma transação financeira registrada até o momento.</p>
    {% endif %}

    <div style="margin-top: 20px;">
        <a href="{% url 'home' %}" class="btn">Voltar para Home</a>
    </div>

</div>
{% endblock %}